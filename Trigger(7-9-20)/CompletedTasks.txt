trigger CompletedTasks on Task (after update, after delete) {
    
    if(Trigger.isUpdate){
        Task taskNEW = Trigger.New[0];
        Task taskOLD = Trigger.Old[0];
        Account a = [Select Completed_Task__c from Account where id=: taskNEW.AccountId];
        if(taskNEW.Status == 'Completed'){
            if(a.Completed_Task__c == null){
                a.Completed_Task__c = 0;                
            }
            Decimal count = a.Completed_Task__c;
            count++;
            a.Completed_Task__c = count;  
        }else if(taskNEW.Status == 'Not Started' || 
                 taskNEW.Status == 'In Progress' || 
                 taskNEW.Status == 'Waiting on someone else' || 
                 taskNEW.Status == 'Deferred'){
                     
                     if(taskOLD.Status == 'Completed'){
                         Decimal count = a.Completed_Task__c;
                         count--;
                         a.Completed_Task__c = count;                                  
                     }
                 }
        update a;
    }
    
    if(Trigger.isDelete){
        Task task = Trigger.Old[0];
        Account a = [select Completed_Task__c from Account where id=: task.AccountId];
        if(task.Status == 'Completed'){
            Decimal count = a.Completed_Task__c;
            count--;
            a.Completed_Task__c = count;
        }
        update a;
    }	
    
    
    
}